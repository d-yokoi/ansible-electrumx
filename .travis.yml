---
language: python
python: "2.7"
env:
  - IMAGE=centos TAG=7

cache: pip

dist: trusty
sudo: required

before_install:
  - sudo apt-get update
  - sudo apt-get install -y python-pip
  - sudo apt-get install -y apt-transport-https ca-certificates
  - echo 'deb https://apt.dockerproject.org/repo ubuntu-trusty main' | sudo tee /etc/apt/sources.list.d/docker.list
  - sudo apt-get update
  - sudo apt-get install -o Dpkg::Options::="--force-confdef" -y docker-engine
  - docker version
  - docker pull $IMAGE:$TAG
  - docker run --name test -di $IMAGE:$TAG /bin/sh
  - |
    if [ ${IMAGE} = "ubuntu" ] || [ ${IMAGE} = "debian" ]; then
      docker exec test apt-get update
      docker exec test apt-get install -y python ca-certificates
    fi
  - |
    if [ ${IMAGE} = "centos" ]; then
      docker exec test yum makecache
      docker exec test yum install -y python ca-certificates
    fi
  - |
    if [ ${IMAGE} = "fedora" ]; then
      docker exec test dnf makecache
      docker exec test dnf install -y python ca-certificates python2-dnf
    fi
install:
  - pip install ansible
  - ansible --version
  - printf '[defaults]\nroles_path=../\ncallback_whitelist=profile_tasks' | tee ansible.cfg
  - pip install ansible-lint
  - ansible-lint --version

script:
  - test/run-all.sh

notifications:
  email: false
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
