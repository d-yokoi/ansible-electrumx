---
- name: download
  get_url: url=https://codeload.github.com/kyuupichan/electrumx/tar.gz/{{ electrumx_version }} dest=/tmp mode=0440
- name: extract
  unarchive: src=/tmp/electrumx-{{ electrumx_version }}.tar.gz dest=/tmp copy=no
- name: "JSONRPC error counter"
  lineinfile: >-
    dest='/tmp/electrumx-{{ electrumx_version }}/lib/jsonrpc.py'
    state=present
    backrefs=yes
    regexp='{{ item.regexp }}'
    line='{{ item.line }}'
  with_items:
  - regexp: '^#?\s*elif self.error_count >= 10:'
    line: '            elif self.error_count >= 1000:'
- name: install
  command: /usr/bin/python3.6 ./setup.py install chdir=/tmp/electrumx-{{ electrumx_version }}
- name: electrumx systemd setup
  template: src="templates/electrumx.service.j2" dest="/etc/systemd/system/electrumx.service" owner=root group=root
- name: electrumx template setup
  template: src="templates/electrumx.conf.j2" dest="/etc/electrumx.conf" owner=root group=root
